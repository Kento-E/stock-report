# GitHub Copilot コードレビュー指示

コードレビューを実施する際は、以下のルールを厳守してください。

## 言語設定

- **すべてのレビューコメントは日本語で記述すること**
- レビュー結果を日本語で記載すること
- PRのタイトルを修正すべきであれば指摘すること

## コード品質のチェック項目

### エラーハンドリング

- **リストや配列へのアクセス前に空チェックが実施されているか**
  - `list[0]`のようなアクセスの前に、`if not list:`または`if len(list) > 0:`でチェックされているか
  - 例: `if similar_messages: first_message = similar_messages[0]`

- **`random.choice()`などの関数使用前に事前チェックがあるか**
  - 空リストで`random.choice()`を呼ぶとIndexErrorが発生
  - 例: `if endings: ending = random.choice(endings) else: ending = "。"`

- **`dict.get()`でデフォルト値が指定され、Noneチェックが追加されているか**
  - `dict.get(key, default_value)`を使用してNone回避
  - 取得後も値が空でないことを確認
  - 例: `greetings = persona.get('sample_greetings', []); if greetings: ...`

- **ファイル・ディレクトリ操作前に存在確認がされているか**
  - ディレクトリ作成: `os.makedirs(path, exist_ok=True)`
  - ファイル存在確認: `if os.path.exists(file_path):`

### 正規表現の結果処理

- **`re.split()`の結果から空文字列が除外されているか**
  - 例: `sentences = [s for s in re.split(r'[。！？]', text) if s.strip()]`
  - 空リスト対策: `response = sentences[0] if sentences else fallback_text`

### コード品質

- **未使用の変数・importが存在しないか**
  - リンター（flake8/pylint）の警告がないか確認
  - IDE/エディタの警告がないか確認

- **変数名は明確か**
  - 目的が分かる名前が使用されているか（例: `query_lower`は小文字変換されたクエリと分かる）
  - 略語は慣例的なもののみ使用されているか

- **コメントは適切か**
  - 複雑なロジックには説明コメントがあるか
  - 自明なコードに不要なコメントがないか
  - 既存のコメントスタイルに合っているか
  - **DRY原則に従っているか**: コメントにコードと同じ情報（変数名、定数値、モデル名など）が記載されていないか

- **削除された機能に関連するコードが完全に削除されているか**
  - 参考資料、コメント、使用例なども含めてすべて削除されているか
  - 過去の実装が参考として残されていないか
  - テストコード内の参考情報表示コードも同様に削除されているか

## テストファイルの確認

- **コード変更がテストに影響を与えていないか確認**
  - プロンプト設定、ドキュメント、エラーメッセージなど、参照される文字列を変更した場合、関連するテストファイルが更新されているか
  - `grep -r "変更した文字列" tests/` で影響範囲が確認されているか

## リンター実行の確認

- **コード変更後にリンターが実行されているか**
  - black, isort, autoflake, flake8 が実行されているか
  - リンターエラーがない状態でコミットされているか
  - CI/CDパイプラインで失敗しないか

## セキュリティチェック

- **機密情報がコードに含まれていないか**
  - APIキー、パスワード、トークンなどがハードコードされていないか
  - 環境変数またはSecretsが適切に使用されているか

## Markdownファイルのチェック

- **見出しの前後に空行があるか**
  - すべての見出し（#, ##, ### など）の直前・直後に必ず 1 行の空行があるか

- **Lintルールに準拠しているか**
  - 見出し階層は 1 段階ずつ（MD001）
  - 見出し・リストの前後に必ず空行（MD022, MD032）
  - h1 は 1 つのみ（MD025）
  - ファイル末尾は 1 つの改行のみ（MD047）

- **コミットハッシュの表記が正しいか**
  - コミットハッシュがバッククォート（`` ` ``）で囲まれていないか確認
  - 前後に半角スペースがあり、装飾なしの素の形式になっているか確認
  - 例: ✅ コミット abc1234 で対応 / ❌ コミット`abc1234`で対応
