# 動作確認手順

> **Note**: ユニットテストの実行方法については [docs/TEST.md](../../docs/TEST.md) を参照してください。  
> このファイルは、システム全体の統合テストとワークフローの動作確認手順を記載しています。

## 1. GitHub Actions による自動実行テスト

### 手動実行の手順

Daily Stock Reportワークフローは任意のブランチから手動実行できます。

1. `.github/workflows/report.yml`が正しく設置されていることを確認する。

2. GitHub リポジトリの「Actions」タブを開く。

3. 左サイドバーから「Daily Stock Report」ワークフローを選択する。

4. 右上の「Run workflow」ボタンをクリックする。

5. 「Use workflow from」ドロップダウンメニューから、実行したいブランチを選択する：
   - **mainブランチ**: 本番環境の設定で実行
   - **PRブランチ**: マージ前に変更内容をテスト実行
   - **featureブランチ**: 開発中の機能をテスト実行

6. 「Run workflow」ボタンをクリックして実行を開始する。

### 実行結果の確認

1. 実行ログで各ステップ（Checkout, Python セットアップ, 依存関係インストール, main.py 実行）が正常に完了することを確認する。

2. レポートファイルの生成・メール送信が成功しているか、ログおよび受信メールで確認する。

### PRブランチでのテスト実行

PRを作成したブランチでワークフローを実行することで、マージ前に以下を確認できます：

- コードの変更が正しく動作するか
- ワークフロー設定の変更が正しく反映されるか
- 実際のメール送信が正常に行われるか

**注意**: メール送信が実際に行われるため、テスト用のメールアドレスを使用することを推奨します。

## 2. エラー発生時の確認

- エラーが発生した場合は、GitHub Actions のログを確認し、原因を特定する。
- Secrets の設定漏れや SMTP 認証エラー、API キーの不備などが主な原因となる。
- Secrets設定については [README.md](../../README.md) の「Github Actions用 Secrets and variables 設定方法」を参照してください。

## 3. 自動マージ機能の動作確認

1. テスト用のブランチを作成し、変更を加える。

2. GitHub 上で Pull Request を作成する。

3. Pull Request を承認（Approve）する。

4. `.github/workflows/auto-merge.yml` ワークフローが自動的に実行されることを確認する。

5. GitHub Actions のログで以下を確認する：
   - PR が承認されたことの検知
   - PR のマージ可能性のチェック
   - スカッシュマージの実行
   - ブランチの自動削除

6. Pull Request がマージされ、ブランチが削除されていることを確認する。

### エラーケース

- PR がマージ可能な状態でない場合（競合がある場合など）は、自動マージは実行されない。
- PR が Draft 状態の場合、Draft である旨が表示されるが、ワークフローはエラーにならず正常終了する。Ready for review に変更してから再度 Approve する必要がある。
- GitHub Actions の権限が不足している場合は、リポジトリ設定を確認する。

---

ファイル末尾は改行 1 つのみ（MD047）。
見出し・リストの前後には必ず空行（MD022, MD032）。
