# 要件定義書

## 1. システム概要

銘柄株の動向やトレンドを Claude Sonnet（AI）で日次に調査・分析し、HTML レポートとして自動生成・メール配信するシステム。

## 2. 目的

- 投資判断の材料となる情報を自動で収集・分析し、分かりやすいレポートとして提供する。
- 日々の株式市場の変化を迅速に把握できるようにする。

## 3. 機能要件

### 3.1 データ収集

- 対象銘柄リスト（例: '7203.T', '6758.T'）の株価データを Yahoo Finance API（RapidAPI 経由）から日次で自動取得する。
- ニュースデータも将来的に拡張可能な構造で取得（現状はダミー実装）。

### 3.2 AI 分析

- Claude Sonnet API（最新モデル: claude-3-sonnet-latest など）を用いて、収集データの動向・トレンド・リスク/チャンスを日本語で要約・分析する。
- API キー・モデル名は環境変数で管理。

### 3.3 レポート生成

- 分析結果を HTML 形式で日次レポートとして自動生成。
- レポートは 1 銘柄ごとに HTML ファイルとして保存し、全銘柄分をまとめてメール本文にも埋め込む。

### 3.4 メール配信

- SMTP サーバ設定・送信元・宛先アドレス等は環境変数で管理。
- 複数宛先対応（カンマ・セミコロン区切り、またはリスト）。
- すべての宛先は BCC で送信し、受信者間でアドレスが見えないよう配慮。
- メール本文は HTML 形式。

### 3.5 スケジューラ・自動化

- GitHub Actions 等の CI/CD で日次自動実行が可能。
- .env や Secrets で安全に API キー・認証情報を管理。

## 4. 非機能要件

- セキュリティ：API キーや個人情報の安全な管理（.env, Secrets, BCC 運用等）。
- パフォーマンス：日次処理が 1 時間以内に完了すること。
- 拡張性：銘柄追加や分析ロジック、ニュース API 拡張が容易。
- 保守性：設定や運用が容易で、モジュール分割・関数化されていること。

## 5. システム構成

- main.py：データ収集・AI 分析・レポート生成・配信の統括
- mail_utils.py：メール送信・SMTP 設定・本文生成のユーティリティ
- requirements.txt：依存パッケージ管理
- .env/.env.example：環境変数テンプレート
- .github/workflows/report.yml：自動実行ワークフロー

## 6. 利用技術

- Python（データ収集・分析・レポート生成・メール送信）
- anthropic（Claude Sonnet API 公式パッケージ）
- requests, python-dotenv, smtplib, email
- GitHub Actions（スケジューラ・自動化）

## 7. 運用・保守

- エラー通知・ログ出力（print ベース、今後拡張可）
- API キー・認証情報の安全な管理
- モデル EOL や API 仕様変更時の迅速な対応

## 8. その他

- 法令遵守（金融商品取引法等）
- 利用規約・プライバシーポリシーの整備

## 9. 実行環境

- GitHub Actions 上で定期実行（cron スケジューラ）を行う。
- 実行時刻は JST（日本標準時）で毎日午前 9 時 10 分。
- Claude Sonnet API キーやメール配信設定等の機密情報は、GitHub リポジトリの「Secrets and variables」で安全に管理する。
- レポート生成・配信処理も Actions workflow で自動化する。

---

（本要件定義書は初版です。今後の議論・運用により随時更新します）
